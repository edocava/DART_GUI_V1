# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer

import time
from collections import *
from pathlib import Path

import terminal
from terminal import TerminalApp
from bitmask import Bitmask, unpack_bitmask
import tkinter as tk
from tkinter import Tk, Canvas, Button, StringVar
import matplotlib.pyplot
from matplotlib.figure import Figure
from Telem import *
matplotlib.use('TkAgg')
import tkintermapview
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg


matplotlib.pyplot.style.use('dark_background')
matplotlib.rcParams['grid.color'] = 'grey'


BGCOLOR = '#161618'

#System Variables
LATITUDE = 0.0
LONGITUDE = 0.0
ALTITUDE = 0.0

window = tk.Tk()
terminal_root = tk.Tk()
window.geometry("550x250+300+300")
window.configure(bg=BGCOLOR)
window.focus_force()

term_app = TerminalApp(terminal_root)

def read_from_terminal():
    LATITUDE = terminal.lat
    LONGITUDE = terminal.lon
    ALTITUDE = terminal.alt


def update_gui():
    start = time.time()

    read_from_terminal()
    window.after(1, update_gui)




canvas = Canvas(
    window,
    bg=BGCOLOR,
    height=832,
    width=1280,
    bd=0,
    highlightthickness=0,
    relief="ridge"
)

canvas.place(x=0, y=0)
y_position = 70  # Inizia a 130, come nel tuo codice originale


# Funzione per aggiungere testo in un layout verticale
def add_text(label, value, y_position, font_size):
    # Creazione del testo dell'etichetta
    canvas.create_text(
        56.0,  # Posizione orizzontale fissa
        y_position,
        anchor="nw",
        text=label,
        fill="#E5E1E1",
        font=("Inter", font_size * -1)
    )

    # Creazione del testo del valore
    return canvas.create_text(
        209.0,  # Posizione orizzontale fissa per il valore
        y_position,
        anchor="nw",
        text=value,
        fill="#E5E1E1",
        font=("Inter", font_size * -1)
    )

# Aggiunta degli elementi in un layout verticale
Altitude = add_text("Altitudine:", "120.00 m\n", y_position, 20)
y_position += 40  # Incrementa la posizione verticale per il prossimo elemento

Latitude = add_text("Latitudine:", "45.9312313°\n", y_position, 20)
y_position += 40  # Incrementa di meno per il font più piccolo

Longitude = add_text("Longitudine:", "7.812312391°\n", y_position, 20)
y_position += 40

def read_status():
    status = "dio cane"
    return status

Status = add_text("Status:", read_status(), y_position, 20)
y_position += 40



bm = Bitmask(1, 1, 1, 1, 1, 1, 1, 1)
y_position = unpack_bitmask(bm, y_position, canvas)

# the figure that will contain the plot
ALT_Plot = Figure(figsize=(4.2, 2.6), dpi=100)
ALT_Plot.set_facecolor(BGCOLOR)
ALT_Plot.suptitle('Altitude AGL (m)')
# list of squares
y = [i ** 2 for i in range(101)]
# adding the subplot
Altitude_Plot = ALT_Plot.add_subplot()
Altitude_Plot.grid(visible=True)
Altitude_Plot.set_facecolor(BGCOLOR)
plot1 = FigureCanvasTkAgg(figure=ALT_Plot, master=window)
plot1.draw()
plot1.get_tk_widget().place(x=36, y=y_position)

# list of squares
y = [i ** 2 for i in range(101)]
# adding the subplot


#map_frame = tk.Frame(window)
map_widget = tkintermapview.TkinterMapView(window, width=750, height=750, corner_radius=10)
map_widget.set_tile_server("https://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}&s=Ga", max_zoom=20)  # google satellite
map_widget.place(x=454, y=34)
map_widget.set_zoom(15)
map_widget.set_position(50.83331266457037, 6.143613257355146)


window.resizable(False, False)
window.title('Ground Station DART V1.0')
window.iconbitmap("Plane.ico")





